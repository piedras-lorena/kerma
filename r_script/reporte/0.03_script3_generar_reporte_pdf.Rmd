---
title: "Reporte Kerma"
output: 
  pdf_document:
# header-includes:
#    - \renewcommand{\contentsname}{Índice}
    toc: TRUE
    toc_depth: 3

#lang: spa
classoption: landscape
sansfont: Arial
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, include = FALSE}
# Importamos paquetes
library(dplyr)
library(tidyr)
library(readr)
library(data.table)
library(stringr)
library(knitr)
library(DT)
library(xtable)
library(kableExtra)
library(pander)

options(scipen = 999)
setwd("/home/lorena/Proyectos/Otros/kerma/r_script/reporte/")
source('../lib/utils_script3.R')

  
id_despacho <- 15
tabla_reporte <- crear_tabla_reporte(id_despacho)
tabla_nombres_despachos <- read_csv('../../data/interim/UsuariosActivos.csv',
                                      col_types = cols(.default = 'c'))
tabla_encuesta <- read_csv('../../data/interim/tabla_encuestas_f.csv',
                           col_types = cols(.default = 'c'))
operaciones <- read_csv('../../data/interim/operaciones_preguntas - col_1.csv',
                        col_types = cols(.default = 'c')) %>%
               mutate(seccion_entera = ifelse(is.na(subseccion),paste(seccion,0,renglon,sep = '_'),paste(seccion,subseccion,renglon,sep = '_'))) %>%
               dplyr:: select(seccion_entera,pregunta_1) %>% plyr::rename(c('pregunta_1'='questionId','seccion_entera'='seccion')) %>%
               group_by(seccion) %>% slice(1)
nombres_preguntas <- tabla_encuesta %>% dplyr::select(questionId,name) %>% unique() %>% left_join(operaciones) %>%
                     filter(!is.na(seccion)) %>% dplyr::select(-questionId)

categoria <- read_csv('../../data/interim/CategoryHumanCapital.csv',
                      col_types = cols(.default = 'c')) %>% dplyr::mutate(categoria_filtro = ifelse(is.na(description_1)|is.na(description_2),description,
                                                                                                    paste(description,description_1,sep = '_')))
```

\pagebreak

1. Información General
------
### 1.1. Introducción
<br>
La realización de esta encuesta surgió de la necesidad de contar con herramientas que nos permitan medir el desempeño de los despachos de abogados, para obtener indicadores que nos guíen hacia la eficiencia, con un mayor control del desempeño.

*"La información por sí sola no constituye conocimiento hasta que, a partir de ella, se piensa algo."*
*Rüdiger Safranski*
<br>

### 1.2. 

## 2. Estructura del Despacho

### 2.1. Total personal profesional
<br>
```{r, echo=FALSE}
filtro_categoria <- sprintf('^%s_',paste(categoria$categoria_filtro %>% unique(),collapse = '_|'))
dt <- tabla_promedio_normal(2,1, 1) 
dt <- dt %>% mutate(`Personal Profesional`= gsub(filtro_categoria,'',dt$nombre_viejo))
filtro_nuevo <- sprintf('_%s$',paste(dt$`Personal Profesional` %>% unique(),collapse = '|_'))
dt <- dt %>% mutate (` `= gsub('_',' ',gsub(filtro_nuevo,' ',dt$nombre_viejo)),
                    `Personal Profesional`= gsub('_',' ',`Personal Profesional`)) %>%
                    dplyr::select(` `,`Personal Profesional`,everything(),-nombre_viejo)

kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8)  %>%
  column_spec(1,width = "4em") %>%
  column_spec(3:5,bold = T) %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.2. Total personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,2, 1)
dt <- dt %>% mutate(nombre_viejo = gsub('_',' ',gsub('gerente_de_administración_|staff_de_administración_','',nombre_viejo))) %>%
      plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
panderOptions('table.split.table', 300)
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.3. Total staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,3, 1)
dt <- dt %>% mutate(nombre_viejo = gsub('_',' ',gsub('apoyo_de_administración_','',nombre_viejo))) %>%
      plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = "striped")  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T)
```

### 2.4. Crecimiento personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,4, 0) %>%
      mutate(nombre_viejo = gsub('_',' ',nombre_viejo)) %>%
      plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 6)  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.5. Crecimiento personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,5, 0) %>%
      mutate(nombre_viejo = gsub('_',' ',nombre_viejo)) %>%
      plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 6)  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.6. Crecimiento staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,6, 0) %>%
      mutate(nombre_viejo = gsub('_',' ',nombre_viejo)) %>%
      plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 6)  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.7. Experiencia personal profesional (años desde la titulación)
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,7, 0) %>%
      mutate(nombre_viejo = gsub('_',' ',nombre_viejo)) %>%
      plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 6)  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.8. Experiencia personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,8, 0) %>%
      mutate(nombre_viejo = gsub('_',' ',nombre_viejo)) %>%
      plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 6)  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.9. Experiencia staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,9, 0)
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 6)  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.10. Antigüedad personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,10, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.11. Antigüedad personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,11, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.12. Antigüedad staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,12, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.13. Rotación personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,13, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.14. Rotación personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,14, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.15. Rotación staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,15, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.16. Edad personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,16, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.17. Edad personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,17, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.18. Edad personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,18, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.19. Razones del personal
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,19, 0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.20. Evaluación desempeño
<br>
```{r, echo=FALSE,message=FALSE}
dt<- tabla_si_no(2,20,c(1,2))
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.20.1. Periodos de evaluación personal profesional
<br>
```{r, echo=FALSE}
dt<- distribucion_tabla(2,20.1)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.20.2. Periodos de evaluación personal profesional
<br>
```{r, echo=FALSE}
dt<- distribucion_tabla(2,20.2)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 2.21. Tipo de evaluación
<br>
```{r, echo=FALSE, message=FALSE}
preguntas <- data.frame(preguntas = c('Las evaluaciones se comparten con el personal','Evalúan sólo los jefes','Existe evaluación de pares de subordinados a superiores','El personal administrativo evalúa al personal profesional'),
                        seccion = sprintf('2_21_%s',seq(1,4)),stringsAsFactors = F)
dt<- tabla_si_no(2,21,aparece_sec = 0)%>% left_join(preguntas) %>%
     dplyr::select(preguntas,SI,NO) %>% plyr::rename(c('preguntas'=''))
panderOptions('table.split.table', 300)      
pander(dt)
```


### 2.22. Oficinas
<br>
```{r, echo=FALSE, message=FALSE}
preguntas <- data.frame(seccion = sprintf('2_23_%s',seq(1,7)),
                        preguntas = c('¿Cuál es el costo por m2 incluyendo mantenimiento? (Dólares)','Área en m2 rentados por despacho','Área en m2 utilizada','Área en m2 sala de juntas','Área en m2 áreas comunes','Promedio en m2 oficina de socios','Promedio en m2 oficina de abogados'),stringsAsFactors = F)
dt<- tabla_promedio_sr(2,23,seq(1,7)) %>% left_join(preguntas) %>%
     dplyr::select(preguntas,Promedio) %>% plyr::rename(c('preguntas'=''))
panderOptions('table.split.table', 300)      
pander(dt)
```

<br>

```{r, echo=FALSE, message=FALSE}
preguntas <- data.frame(preguntas = c('Utilizan privados compartidos para los abogados'),stringsAsFactors = F)
dt<- tabla_si_no(2,23,c(8)) %>% bind_cols(preguntas) %>%
     dplyr::select(preguntas,SI,NO) %>% plyr::rename(c('preguntas' = '')) 
panderOptions('table.split.table', 300)      
pander(dt)
```

## 3. Compensaciones y prestaciones
### 3.1. Sueldo base promedio mensual personal por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,1)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.3. Sueldo base promedio mensual personal por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,3,'personal_edad_tarifa')
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.4. Sueldo base promedio mensual personal administrativo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,4)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.5. Sueldo base promedio mensual staff apoyo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,5)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.6. Sueldo base promedio anual personal profesional por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,6)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.7. Sueldo base promedio anual personal profesional por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,7,'personal_edad_tarifa')
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.8. Sueldo base promedio anual personal administrativo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,8)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.9. Sueldo base promedio anual staff apoyo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,9)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.10. Sueldo base promedio anual con compensaciones personal profesional por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,10)
panderOptions('table.split.table', 300)      
pander(dt)
```
### 3.11. Sueldo base promedio anual con compensaciones personal profesional por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,11,'personal_edad_tarifa')
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.12. Sueldo base promedio anual con compensaciones personal administrativo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,12)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.13. Sueldo base promedio anual con compensaciones staff apoyo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,13)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.14. Sueldo profesionales no abogados
### 3.14.1 Sueldo base promedio mensual personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.1)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.14.2 Sueldo base promedio anual personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.2)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.14.3 Sueldo base promedio anual con compensaciones personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.3)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.15 Incrementos de Sueldo
### 3.15.1. Incremento en 2016
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(3,15.1,porcent_h_m = 0) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>% plyr::rename(
        c('name'='2017'))

panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.15.2. Incremento estimado para 2017
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(3,15.2,porcent_h_m = 0) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>% plyr::rename(
        c('name'='2017'))

panderOptions('table.split.table', 300)      
pander(dt)
```

### 3.15.3 Fecha de incremento
Falta

### 3.16. Operación
### 3.16.1 Forma de pago de abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(3,16.1,renglones = c(1:5),nombre_col = 'Forma de pago mensual abogados') 
panderOptions('table.split.table', 300)      
pander(dt)
dt <- tabla_si_no(3,16.1,renglones = c(6),aparece_sec = 0) %>%
      mutate(Pregunta = '¿En la remuneración se reconoce la originación de clientes/asuntos?') %>% dplyr::select(Pregunta,SI,NO) %>%
      plyr::rename(c('Pregunta'=''))
panderOptions('table.split.table', 300)      
pander(dt)
dt <- distribucion_tabla(3,16.1,renglones = c(7:12),nombre_col = '¿Cómo se reconoce la originación de clientes/asuntos?') 
panderOptions('table.split.table', 300)      
pander(dt)
``` 

### 3.16.2. Fórmula de remuneración de socios
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(3,16.2,nombre_col = '¿Cuál es su sistema de remuneración de socios?') 
panderOptions('table.split.table', 300)      
pander(dt)
``` 

### 3.16.3. Plan de carrera y desarrollo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.3,c(1),aparece_sec = 0) %>%
      mutate(Pregunta = '¿Cuentan con un plan de carrera para los abogados de la firma?') %>% select(Pregunta, SI, NO) %>% plyr::rename(
        c('Pregunta'=''))
panderOptions('table.split.table', 300)      
pander(dt)

nombre_acronimo <- tabla_nombres_despachos %>% filter(id == id_despacho)
dt <- tabla_reporte %>% filter(grepl('^3_16.3_2',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '¿Cuántos niveles/categorías de abogados tienen') %>% plyr::rename(c('nombre_viejo'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.3,c(3),aparece_sec = 0) %>%
      mutate(Pregunta = '¿Cuentan con un plan de desarrollo profesional individual?') %>% select(Pregunta, SI, NO) %>% plyr::rename(
        c('Pregunta'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_reporte %>% filter(grepl('^3_16.3_4',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '¿Cuántos niveles/categorías de abogados tienen') %>% plyr::rename(c('nombre_viejo'=''))
panderOptions('table.split.table', 300)      
pander(dt)

 dt<- distribucion_tabla(3,16.3,c(5:13),nombre_col = '¿Cuántos años en promedio le debe tomar a un abogado recién recibido para llegar a ser socio de la firma?')
panderOptions('table.split.table', 300)      
pander(dt)
``` 

### 3.16.4. Comportamiento estructura despacho personal profesional
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.4,c(1),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Contrataciones') %>% select(`Personal profesional`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)

nombre_acronimo <- tabla_nombres_despachos %>% filter(id == id_despacho)
dt <- tabla_reporte %>% filter(grepl('^3_16.4_2',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% contratación') %>% plyr::rename(c('nombre_viejo'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.4,c(3),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Aumento de sueldos') %>% select(`Personal profesional`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_reporte %>% filter(grepl('^3_16.4_4',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Aumento de sueldos') %>% plyr::rename(c('nombre_viejo'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.4,c(5),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Ascensos de nivel') %>% select(`Personal profesional`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.4,c(6),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Recorte de personal') %>% select(`Personal profesional`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_reporte %>% filter(grepl('^3_16.4_7',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Recorte de personal') %>% plyr::rename(c('nombre_viejo'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.4,c(8),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Incrementos 1er semestre 2018') %>% select(`Personal profesional`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)
``` 

### 3.16.5. Comportamiento estructura despacho personal administrativo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.5,c(1),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Contrataciones') %>% select(`Personal administrativo`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)

nombre_acronimo <- tabla_nombres_despachos %>% filter(id == id_despacho)
dt <- tabla_reporte %>% filter(grepl('^3_16.5_2',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% contratación') %>% plyr::rename(c('nombre_viejo'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.5,c(3),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Aumento de sueldos') %>% select(`Personal administrativo`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_reporte %>% filter(grepl('^3_16.5_4',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Aumento de sueldos') %>% plyr::rename(c('nombre_viejo'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.5,c(5),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Ascensos de nivel') %>% select(`Personal administrativo`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(3,16.5,c(6),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Recorte de personal') %>% select(`Personal administrativo`, SI, NO) 
panderOptions('table.split.table', 300)      
pander(dt)


dt <- tabla_si_no(3,16.5,c(7),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Incrementos 1er semestre 2018') %>% select(`Personal profesional`, SI, NO) 


panderOptions('table.split.table', 300)      
pander(dt)
``` 


## 4. Bonos e incentivos
Falta meter esta sección

## 5. Prestaciones
### 5.1. Aguinaldo personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,1.1)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 5.2. Aguinaldo personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,2)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 5.3. Aguinaldo staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,3)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 5.4. Entrega de aguinaldo
Falta esta tabla
<br>
```{r, echo=FALSE}
dt <- distribucion_tabla(5,4)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 5.5. Reparto de utilidades
Falta esta tabla
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(5,5,c(1),aparece_sec = 0) %>%
      mutate(Pregunta = '¿Este año se realizará reparto de utilidades?') %>% select(Pregunta, SI, NO) %>% plyr::rename(
        c('Pregunta'=''))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- distribucion_tabla(5,5,c(2:4),nombre_col = '¿Correspondientes a qué año?') 
panderOptions('table.split.table', 300)      
pander(dt)

preguntas <- data.frame(preguntas = c('No de días considerados al año','Sueldo máximo considerado'), seccion = c('5_5_3','5_5_4'),stringsAsFactors = F)
dt <-tabla_reporte %>% filter(grepl('^5_5_(3|4)',seccion)) %>% dplyr::select(seccion,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% left_join(preguntas) %>% select(preguntas,everything(),-seccion)
panderOptions('table.split.table', 300)      
pander(dt)

dt <- distribucion_tabla(5,5,c(5:9),nombre_col = 'Mes de pago para reparto de utilidades')
panderOptions('table.split.table', 300)      
pander(dt)
```

### 5.6. Vacaciones personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,6)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 5.7. Vacaciones personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,7)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 5.8. Vacaciones staff de apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,8)
panderOptions('table.split.table', 300)      
pander(dt)
```


## 6. Seguros y jubilación
### 6.1. Seguro de vida
Falta sección
<br>

### 6.2. Gastos médicos
<br>

```{r, echo=FALSE}
prueba <- tabla_reporte %>% filter(grepl('^6_2_',seccion)) %>% select(valor_1_1,valor_2_1,Promedio,valor_1_3,valor_2_3,valor_1_4,valor_2_4)
```


## 7. Tarifas y rentabilidad
### 7.1. Ingresos
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,1) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>%
      plyr::rename(c('name'='Ingresos'))
panderOptions('table.split.table', 300)      
pander(dt)
```

### 7.2. Tipo de cambio
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,2) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>%
      plyr::rename(c('name'='Ingresos'))
panderOptions('table.split.table', 300)      
pander(dt)
```

### 7.3. Tipo de cambio
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,3)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 7.4. Facturación
<br>
```{r, echo=FALSE,message=FALSE}
preguntas <- data.frame(Preguntas = c('¿En qué porcentaje de las facturas se otorgan descuento?',
                                      '¿Qué porcentaje de la facturación se cobra en pesos?',
                                      '¿Qué porcentaje de las horas facturadas no las paga el cliente?',
                                      '¿Cuál es el descuento promedio que han otorgado esta año a sus clientes?'),
                        seccion = sprintf('7_4_%s',c(1:4)), stringsAsFactors = F)
dt <- tabla_reporte %>% filter(grepl('^7_4_',seccion)) %>%
      dplyr::select(seccion,Promedio,`25%`,`50%`,`75%`,Alto,Bajo) %>% left_join(preguntas) %>%
      dplyr::select(Preguntas,everything(),-seccion) %>% plyr::rename(c('Preguntas'=''))
panderOptions('table.split.table', 300)      
pander(dt)
```



## 8. Tarifas
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,0)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 8.1. Horas objetivo por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,1)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 8.2. Horas reportadas por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,2)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 8.3. Horas objetivo por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,3)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 8.4. Realización
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,4)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 8.5. Productividad
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,5)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 8.6. Horas objetivo, horas reportadas, horas facturadas personal profesional por años de experiencia
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,6)
panderOptions('table.split.table', 300)      
pander(dt)
```

### 8.7. Realización y productividad abogados por años de experiencia
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,7)
panderOptions('table.split.table', 300)      
pander(dt)
```

## 9. Cuentas por cobrar
```{r, echo=FALSE}
preguntas <- data.frame(preguntas = c('Días cartera promedio',
                                      'Aumento de % cartera vencida en días'))
dt <- tabla_promedio_normal(9,0) %>% bind_cols(preguntas) %>%
      dplyr::select(preguntas, everything(),-nombre_viejo) %>% 
      plyr::rename(c('preguntas'='')) 
panderOptions('table.split.table', 300)      
pander(dt)
```

## 10. Mercadotecnia
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_si_no(10,0,c(1:3))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(10,0,c(4:11),aparece_sec = 0) %>% 
      left_join(operaciones) %>% left_join(tabla_encuesta[c('questionId',
                                                            'wildcard')] %>% unique()) 
dt<- dt[,-1] %>% select(wildcard,everything(),-seccion,-questionId) %>%
      plyr::rename(c('wildcard'='¿Cuáles de los siguientes medios de promoción utilizan?'))
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(10,0,c(12:16),aparece_sec = 0) %>% 
      left_join(operaciones) %>% left_join(tabla_encuesta[c('questionId',
                                                            'wildcard')] %>% unique()) 
dt<- dt[!is.na(dt$wildcard),-1] %>% select(wildcard,everything(),-seccion,-questionId) %>%
      plyr::rename(c('wildcard'='¿Utilizan "social media" como medio de promoción?'))
panderOptions('table.split.table', 300)      
pander(dt)
```

## 11. Tecnologías de Información
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_si_no(11,0,c(1:5))
colnames(dt)[1] <- 'Planeación'
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(11,0,c(6:8))
colnames(dt)[1] <- 'Seguridad'
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(11,0,c(9:11))
colnames(dt)[1] <- 'Internet y redes sociales'
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(11,0,c(12:13))
colnames(dt)[1] <- 'Sistema administrativo "back office"'
panderOptions('table.split.table', 300)      
pander(dt)

dt <- tabla_si_no(11,0,c(14:15))
colnames(dt)[1] <- 'Colaboración y administración documental'
panderOptions('table.split.table', 300)      
pander(dt)
```
