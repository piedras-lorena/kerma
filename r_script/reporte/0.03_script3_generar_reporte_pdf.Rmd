---
title: ""
output: 
  pdf_document:
# header-includes:
#    - \renewcommand{\contentsname}{Índice}
    toc: TRUE
    toc_depth: 3

#lang: spa
classoption: landscape
sansfont: Arial
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, include = FALSE}
# Importamos paquetes
library(dplyr)
library(tidyr)
library(readr)
library(data.table)
library(stringr)
library(knitr)
library(DT)
library(xtable)
library(kableExtra)
library(pander)
library(scales)
library(ggplot2)

options(scipen = 999)
setwd("/home/lorena/Proyectos/Otros/kerma/r_script/reporte/")
source('../lib/utils_script3.R')

  
id_despacho <- 15
tabla_reporte <- crear_tabla_reporte(id_despacho)
tabla_nombres_despachos <- read_csv('../../data/interim/UsuariosActivos.csv',
                                      col_types = cols(.default = 'c'))
tabla_encuesta <- read_csv('../../data/interim/tabla_encuestas_f.csv',
                           col_types = cols(.default = 'c'))
operaciones <- read_csv('../../data/interim/operaciones_preguntas - col_1.csv',
                        col_types = cols(.default = 'c')) %>%
               mutate(seccion_entera = ifelse(is.na(subseccion),paste(seccion,0,renglon,sep = '_'),paste(seccion,subseccion,renglon,sep = '_'))) %>%
               dplyr:: select(seccion_entera,pregunta_1) %>% plyr::rename(c('pregunta_1'='questionId','seccion_entera'='seccion')) %>%
               group_by(seccion) %>% slice(1)
nombres_preguntas <- tabla_encuesta %>% dplyr::select(questionId,name) %>% unique() %>% left_join(operaciones) %>%
                     filter(!is.na(seccion)) %>% dplyr::select(-questionId)

categoria <- read_csv('../../data/interim/CategoryHumanCapital.csv',
                      col_types = cols(.default = 'c')) %>% dplyr::mutate(categoria_filtro =    ifelse(is.na(description_1)|is.na(description_2),description,paste(description,description_1,sep = '_')))

diccionario_diferentes <- read_csv('../../data/interim/tablas_resumen_diferentes - Hoja 1.csv',col_types = cols(.default = 'c')) %>%
                          mutate(seccion = ifelse(is.na(renglon),paste(seccion,subseccion,sep = '_'),
                                 paste(seccion,subseccion,renglon,sep = '_')),
                                 columna_1 = word(columna_1,1,sep = '_')) %>%
                          dplyr::select(seccion,columna_1) %>%
                          plyr::rename(c('columna_1' = 'questionId'))
diccionario_aguinaldo <- data.frame(nombre_viejo = c('111','190','241','262','285'), nombre = c('Abogados','Pasantes','Gerentes área administrativa','Staff administrativo','Apoyo administrativo'),stringsAsFactors = F)

filtro_categoria <- sprintf('^%s_',paste(categoria$categoria_filtro %>% unique(),collapse = '_|'))
                        
```

\pagebreak

1. Información General
------
### 1.1. Introducción
<br>
La realización de esta encuesta surgió de la necesidad de contar con herramientas que nos permitan medir el desempeño de los despachos de abogados, para obtener indicadores que nos guíen hacia la eficiencia, con un mayor control del desempeño.

*"La información por sí sola no constituye conocimiento hasta que, a partir de ella, se piensa algo."*
*Rüdiger Safranski*

<br>
\pagebreak

### 1.2. 

## 2. Estructura del Despacho

### 2.1. Total personal profesional
<br>
```{r, echo=FALSE, fig.width=18, fig.height=12}
dt <- tabla_promedio_normal(2,1, 1) 
dt <- dt %>% mutate(`Personal Profesional`= gsub(filtro_categoria,'',dt$nombre_viejo))
filtro_nuevo <- sprintf('_%s$',paste(dt$`Personal Profesional` %>% unique(),collapse = '|_'))
dt <- dt %>% mutate (` `= gsub('_',' ',gsub(filtro_nuevo,' ',nombre_viejo)),
                    `Personal Profesional`= gsub('_',' ',`Personal Profesional`)) %>%
                    dplyr::select(` `,`Personal Profesional`,everything(),-nombre_viejo)


kable(dt, format = "latex", booktabs = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8)  %>%
  column_spec(1,width = "4em") %>%
  column_spec(3:5,bold = T) %>%
  collapse_rows(columns = 1)
nombre_acronimo <- tabla_nombres_despachos %>% filter(id == id_despacho)
plot <- dt[,c(1,2,3,6)] 
colnames(plot) = c('n_1','n_2',nombre_acronimo$acronimo,'Promedio')
plot[, 2:3][is.na(plot[, 2:3])] <- 0
plot[is.nan(plot$Promedio),'Promedio'] <- 0
plot <- plot %>% mutate(Categoria = paste(n_1,n_2)) %>%
        dplyr::select(-n_1,-n_2) %>%
        gather(key = 'variable',value = 'total_personal',1:2)
ggplot(plot, aes(x = Categoria, y = total_personal,fill = variable)) + geom_bar(position = 'dodge',stat="identity") +
  coord_flip() + theme_grey(base_size = 18)  
```

\pagebreak

### 2.2. Total personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,2, 1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3:5,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.3. Total staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,3, 1)
# dt <- dt %>% mutate(nombre_viejo = gsub('_',' ',gsub('apoyo_de_administración_','',nombre_viejo))) %>%
#       plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.4. Crecimiento personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,4, 0) 
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.5. Crecimiento personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,5, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
  kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.6. Crecimiento staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,6, 0)

dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.7. Experiencia personal profesional (años desde la titulación)
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,7, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.8. Experiencia personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,8, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.9. Experiencia staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,9, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]

kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.10. Antigüedad personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,10, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.11. Antigüedad personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,11, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.12. Antigüedad staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,12, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)

dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.13. Rotación personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,13, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.14. Rotación personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,14, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[grepl('^gerente_',dt$nombre_viejo),2:8] <- dt[grepl('^gerente_',dt$nombre_viejo),2:8]/100
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.15. Rotación staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,15, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.16. Edad personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,16, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.17. Edad personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,17, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.18. Edad staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,18, 0)

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.19. Razones del Personal
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,19, 0)
dt[,2:8] <- format(round(sapply(dt[,2:8],as.numeric),digits = 2),scientific=FALSE)


kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.20. Evaluación desempeño
<br>
```{r, echo=FALSE,message=FALSE}
dt<- tabla_si_no(2,20,c(1,2))
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 2.20.1. Periodos de evaluación personal profesional
<br>
```{r, echo=FALSE}
dt<- distribucion_tabla(2,20.1)
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```

### 2.20.2. Periodos de evaluación personal profesional
<br>
```{r, echo=FALSE}
dt<- distribucion_tabla(2,20.2)
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```

### 2.21. Tipo de evaluación
<br>
```{r, echo=FALSE, message=FALSE}
preguntas <- data.frame(preguntas = c('Las evaluaciones se comparten con el personal','Evalúan sólo los jefes','Existe evaluación de pares de subordinados a superiores','El personal administrativo evalúa al personal profesional'),
                        seccion = sprintf('2_21_%s',seq(1,4)),stringsAsFactors = F)
dt<- tabla_si_no(2,21,aparece_sec = 0)%>% left_join(preguntas) %>%
     dplyr::select(preguntas,SI,NO) %>% plyr::rename(c('preguntas'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>% 
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```


### 2.22. Oficinas
<br>
```{r, echo=FALSE, message=FALSE}
preguntas <- data.frame(seccion = sprintf('2_23_%s',seq(1,7)),
                        preguntas = c('¿Cuál es el costo por m2 incluyendo mantenimiento? (Dólares)','Área en m2 rentados por despacho','Área en m2 utilizada','Área en m2 sala de juntas','Área en m2 áreas comunes','Promedio en m2 oficina de socios','Promedio en m2 oficina de abogados'),stringsAsFactors = F)
dt<- tabla_promedio_sr(2,23,seq(1,7)) %>% left_join(preguntas) %>%
     dplyr::select(preguntas,Promedio) %>% plyr::rename(c('preguntas'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```

<br>

```{r, echo=FALSE, message=FALSE}
 preguntas <- data.frame(preguntas = c('Utilizan privados compartidos para los abogados'),stringsAsFactors = F)
 dt<- tabla_si_no(2,23,c(8)) %>% bind_cols(preguntas) %>%
      dplyr::select(preguntas,SI,NO) %>% plyr::rename(c('preguntas' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")
```

## 3. Compensaciones y prestaciones
### 3.1. Sueldo base promedio mensual personal por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.3. Sueldo base promedio mensual personal por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,3,'personal_edad_tarifa')
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.4. Sueldo base promedio mensual personal administrativo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,4)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1:2,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.5. Sueldo base promedio mensual staff apoyo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,5)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.6. Sueldo base promedio anual personal profesional por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,6)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.7. Sueldo base promedio anual personal profesional por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,7,'personal_edad_tarifa')
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.8. Sueldo base promedio anual personal administrativo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,8)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1:2,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.9. Sueldo base promedio anual staff apoyo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,9)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.10. Sueldo base promedio anual con compensaciones personal profesional por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,10)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.11. Sueldo base promedio anual con compensaciones personal profesional por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,11,'personal_edad_tarifa')
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.12. Sueldo base promedio anual con compensaciones personal administrativo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,12)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1:2,width = "6em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.13. Sueldo base promedio anual con compensaciones staff apoyo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,13)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.14. Sueldo profesionales no abogados
### 3.14.1 Sueldo base promedio mensual personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Profesionales No Abogados',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.14.2 Sueldo base promedio anual personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.2)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Profesionales No Abogados',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.14.3 Sueldo base promedio anual con compensaciones personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.3)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Profesionales No Abogados',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 3.15 Incrementos de Sueldo
### 3.15.1. Incremento en 2017
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(3,15.1,porcent_h_m = 0) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>% plyr::rename(
        c('name'='2017'))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")%>%
  collapse_rows(columns = 1)
```

### 3.15.2. Incremento estimado para 2018
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(3,15.2,porcent_h_m = 0) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>% plyr::rename(
        c('name'='2018'))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")%>%
  collapse_rows(columns = 1)

```

### 3.15.3 Fecha de incremento
<br>
```{r, echo=FALSE, message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^3_15.3',seccion)) %>% dplyr::select(respuesta_unica,valor_1) %>%
      plyr::rename(c('respuesta_unica' = 'Mes','valor_1' = 'Porcentaje'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")%>%
  collapse_rows(columns = 1)

```

### 3.16. Operación
### 3.16.1 Forma de pago de abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(3,16.1,renglones = c(1:5),nombre_col = 'Forma de pago mensual abogados')
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")%>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(3,16.1,renglones = c(6),aparece_sec = 0) %>%
      mutate(Pregunta = '¿En la remuneración se reconoce la originación de clientes/asuntos?') %>% dplyr::select(Pregunta,SI,NO) %>%
      plyr::rename(c('Pregunta'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")%>%
  collapse_rows(columns = 1)

dt <- distribucion_tabla(3,16.1,renglones = c(7:12),nombre_col = '¿Cómo se reconoce la originación de clientes/asuntos?')
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")%>%
  collapse_rows(columns = 1)

```

### 3.16.2. Fórmula de remuneración de socios
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(3,16.2,nombre_col = '¿Cuál es su sistema de remuneración de socios?')
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")%>%
  collapse_rows(columns = 1)
```

### 3.16.3. Plan de carrera y desarrollo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.3,c(1),aparece_sec = 0) %>%
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) 
dt <- dt[,-1] %>%
      dplyr::select(name,everything(),-seccion,-questionId) %>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_promedio_normal(3,'16.3') %>% filter(nombre_viejo == '237') %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(), by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo)%>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.3,c(3),aparece_sec = 0) %>%
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) 
dt <- dt[,-1] %>%
      dplyr::select(name,everything(),-seccion,-questionId) %>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_promedio_normal(3,'16.3') %>% filter(nombre_viejo == '240') %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(), by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo)%>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- distribucion_tabla(3,'16.3',c(5:13),'¿Cuántos años en promedio le debe tomar a un abogado recién recibido ser socio de la firma? ')
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")
```


### 3.16.4. Comportamiento estructura despacho personal profesional
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.4,c(1),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Contrataciones') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

nombre_acronimo <- tabla_nombres_despachos %>% filter(id == id_despacho)
dt <- tabla_reporte %>% filter(grepl('^3_16.4_2',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% contratación') %>% plyr::rename(c('nombre_viejo'=''))

dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.4,c(3),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Aumento de sueldos') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_reporte %>% filter(grepl('^3_16.4_4',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Aumento de sueldos') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.4,c(5),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Ascensos de nivel') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.4,c(6),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Recorte de personal') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_reporte %>% filter(grepl('^3_16.4_7',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Recorte de personal') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.4,c(8),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Incrementos 1er semestre 2018') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")
```

### 3.16.5. Comportamiento estructura despacho personal administrativo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.5,c(1),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Contrataciones') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

nombre_acronimo <- tabla_nombres_despachos %>% filter(id == id_despacho)
dt <- tabla_reporte %>% filter(grepl('^3_16.5_2',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% contratación') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.5,c(3),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Aumento de sueldos') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_reporte %>% filter(grepl('^3_16.5_4',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Aumento de sueldos') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.5,c(5),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Ascensos de nivel') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(3,16.5,c(6),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Recorte de personal') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")


dt <- tabla_si_no(3,16.5,c(7),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Incrementos 1er semestre 2018') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

```

## 4. Bonos e incentivos
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(4,0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Bono (expresado en meses que se otorgan)',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 4.1 Periodicidad y fecha de entrega del bono
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(4,1,renglones = c(1:12),nombre_col = 'Fecha en que se entrega el bono de Abogados') 
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")
dt <- distribucion_tabla(4,1,renglones = c(13:24),nombre_col = 'Fecha en que se entrega el bono de Administrativos') 
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")
dt <- distribucion_tabla(4,1,renglones = c(25:28),nombre_col = 'Periodicidad del bono Personal Profesional') 
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")
dt <- distribucion_tabla(4,1,renglones = c(29:32),nombre_col = 'Periodicidad del bono Personal Administrativo') 
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

```

### 4.2 Elementos para determinar el bono
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(4,2,c(1:6),0) %>% left_join(diccionario_diferentes) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique())
dt <- dt[,-1] %>% dplyr::select(name,SI,NO) %>%
      plyr::rename(c('name' = 'Elementos para determinar el bono de Personal Profesional'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

dt <- tabla_si_no(4,2,c(7:10),0) %>% left_join(diccionario_diferentes) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique())
dt <- dt[,-1] %>% dplyr::select(name,SI,NO) %>%
      plyr::rename(c('name' = 'Elementos para determinar el bono de Personal Administrativo'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

```

### 4.3. Porcentaje de sueldo que representa la parte variable

```{r, echo=FALSE}
dt <- tabla_promedio_normal(4,3) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(), by = c('nombre_viejo' = 'questionId')) %>%
      dplyr::select(name, everything(),-nombre_viejo) %>% plyr::rename(c('name' = ' '))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```


## 5. Prestaciones
### 5.1. Aguinaldo personal profesional
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_promedio_normal(5,1.1) %>% left_join(diccionario_aguinaldo) %>%
      dplyr::select(nombre,everything(),-nombre_viejo) %>% plyr::rename(c('nombre'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```

### 5.2. Aguinaldo personal administrativo
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_promedio_normal(5,2) %>% left_join(diccionario_aguinaldo) %>%
      dplyr::select(nombre,everything(),-nombre_viejo) %>% plyr::rename(c('nombre'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```

### 5.3. Aguinaldo staff apoyo
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_promedio_normal(5,3) %>% left_join(diccionario_aguinaldo) %>%
      dplyr::select(nombre,everything(),-nombre_viejo) %>% plyr::rename(c('nombre'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")
```

### 5.5. Reparto de utilidades
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(5,5,c(1),aparece_sec = 0) %>%
      mutate(Pregunta = '¿Este año se realizará reparto de utilidades?') %>% select(Pregunta, SI, NO) %>% plyr::rename(
        c('Pregunta'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)

dt <- distribucion_tabla(5,5,c(2:4),nombre_col = '¿Correspondientes a qué año?') 
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")

preguntas <- data.frame(preguntas = c('No de días considerados al año','Sueldo máximo considerado'), seccion = c('5_5_3','5_5_4'),stringsAsFactors = F)
dt <-tabla_reporte %>% filter(grepl('^5_5_(3|4)',seccion)) %>% dplyr::select(seccion,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% left_join(preguntas) %>% select(preguntas,everything(),-seccion)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")

dt <- distribucion_tabla(5,5,c(5:9),nombre_col = 'Mes de pago para reparto de utilidades')
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em")
```

### 5.6. Vacaciones personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,6)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 5.7. Vacaciones personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,7)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 5.8. Vacaciones staff de apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,8)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```


## 6. Seguros y jubilación
### 6.1. Seguro de vida
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_reporte %>% filter(grepl('^6_1_',seccion)) %>% dplyr::select(valor_1_1,valor_2_1,Promedio,
                                                                         valor_1_3,valor_2_3,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c(' ','SI','NO','Años de trabajo asegurados','SI','N0')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Seguro de Vida" = 3, "Seguro de Vida en el Extranjero" = 2)) %>%
  collapse_rows(columns = 1)
```

### 6.2. Gastos médicos
<br>

```{r, echo=FALSE,message=FALSE}
dt <- tabla_reporte %>% filter(grepl('^6_2_',seccion)) %>% dplyr::select(valor_1_1,valor_2_1,Promedio,
                                                                         valor_1_3,valor_2_3,seccion, valor_1_4,valor_2_4) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c(' ','SI','NO','Suma Asegurada','SI','N0','SI','NO')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Gastos Médicos Mayores" = 3, "Gastos Médicos en el Extranjero" = 2,
                     "Gastos Médicos Menores" = 2)) %>%
  collapse_rows(columns = 1)
```

### 6.3. Edad de retiro y jubilación
<br>

```{r, echo=FALSE,message=FALSE}
dt <- tabla_reporte %>% filter(grepl('^6_3_',seccion)) %>% dplyr::select(valor_1_1,valor_2_1,
                                                                         valor_1_3,valor_2_3,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c(' ','SI','NO','SI','N0')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Edad para el retiro" = 2, "Planes de jubilación" = 2)) %>%
  collapse_rows(columns = 1)
```

### 6.4. Sucesión y Seguro de Responsabilidad Civil
<br>

```{r, echo=FALSE,message=FALSE}
renglones <- paste(c(1:7),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^6_4_(%s)$',renglones),seccion)) %>% dplyr::select(valor_1,valor_2,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c('Sistema de sucesión','SI','NO')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)

renglones <- paste(c(8:12),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^6_4_(%s)$',renglones),seccion)) %>% dplyr::select(valor_1,valor_2,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c('Seguro de Responsabilidad Civil Profesional','SI','NO')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)

```

### 6.5. Días festivos
<br>

```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_5_',seccion) & !is.na(respuesta_unica)) %>% dplyr::select(respuesta_unica,Porcentaje)

colnames(dt) <- c('Días festivos adicionales a la ley', 'No laborable')
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)
```

### 6.6. Otras prestaciones
<br>
```{r, echo=FALSE,message=FALSE}

renglones <- paste(c(1:19),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^6_6_(%s)$',renglones),seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,valor_1_3,valor_2_3,valor_1_4,valor_2_4,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c(' ', 'SI','NO','SI','NO','SI','NO','SI','NO')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Previsión Social" = 2, "Fondo de Ahorro" = 2, "Vales de Despensa" = 2, "Ayuda para Comida" = 2)) %>%
  collapse_rows(columns = 1)

renglones <- paste(c(20:21),collapse = '|')
dt <- distribucion_tabla(6,6,renglones,nombre_col = 'Tipo de ayuda para comida')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  collapse_rows(columns = 1)


```

### 6.7. Apoyo en estudios
<br>
```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_7_',seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,valor_1_3,valor_2_3,valor_1_4,valor_2_4,valor_1_5,valor_2_5,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c(' ', 'SI','NO','SI','NO','SI','NO','SI','NO','SI','NO')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Internship" = 2, "Apoyo en estudios y capacitación" = 2, "Coaching" = 2, "Becas nacionales" = 2,
                     "Becas extranjero"= 2)) %>%
  collapse_rows(columns = 1)

```

### 6.8. Pago de asociaciones y promoción
<br>
```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_8_',seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,valor_1_3,valor_2_3,valor_1_4,valor_2_4,valor_1_5,valor_2_5,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c(' ', 'SI','NO','SI','NO','SI','NO','SI','NO','SI','NO')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Celular" = 2, "Pago de cuotas en asociaciones nacionales" = 2, "Pago de cuotas en asociaciones internacionales" = 2, 
                     "Viajes de promoción" = 2,"Colegiaturas"= 2)) %>%
  collapse_rows(columns = 1)

```

### 6.9. Automóvil/motocicleta
<br>
```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_9_',seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
colnames(dt) <- c(' ', 'SI','NO','SI','NO')

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Automóvil" = 2, "Motocicleta" = 2)) %>%
  collapse_rows(columns = 1)

```

## 7. Tarifas y rentabilidad

### 7.1. Ingresos
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,1) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>%
      plyr::rename(c('name'='Ingresos'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 7.2. Tipo de cambio
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,2) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>%
      plyr::rename(c('name'='Ingresos'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T)
```

### 7.3. Tipo de cambio
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,3)
dt[,2] <- round(sapply(dt[,2],as.numeric),digits = 2)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 7.4. Facturación
<br>
```{r, echo=FALSE,message=FALSE}
preguntas <- data.frame(Preguntas = c('¿En qué porcentaje de las facturas se otorgan descuento?',
                                      '¿Qué porcentaje de la facturación se cobra en pesos?',
                                      '¿Qué porcentaje de las horas facturadas no las paga el cliente?',
                                      '¿Cuál es el descuento promedio que han otorgado esta año a sus clientes?'),
                        seccion = sprintf('7_4_%s',c(1:4)), stringsAsFactors = F)
dt <- tabla_reporte %>% filter(grepl('^7_4_',seccion)) %>%
      dplyr::select(seccion,Promedio,`25%`,`50%`,`75%`,Alto,Bajo) %>% left_join(preguntas) %>%
      dplyr::select(Preguntas,everything(),-seccion) %>% plyr::rename(c('Preguntas'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```



## 8. Tarifas
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 8.1. Horas objetivo por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 8.2. Horas reportadas por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,2)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 8.3. Horas objetivo por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,3)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 8.4. Realización
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,4)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 8.5. Productividad
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,5)
dt[,2] <- round(sapply(dt[,2],as.numeric),digits = 2)

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T) %>%
  collapse_rows(columns = 1)
```

### 8.6. Horas objetivo, horas reportadas, horas facturadas personal profesional por años de experiencia
<br>
```{r, echo=FALSE}
renglones <- paste(c(1:8),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_6_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo)))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas objetivo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

renglones <- paste(c(9:16),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_6_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) 
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas reportadas',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

renglones <- paste(c(17:24),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_6_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo)))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas facturadas',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

### 8.7. Realización y productividad abogados por años de experiencia
<br>
```{r, echo=FALSE}
renglones <- paste(c(1:8),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_7_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo)))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas objetivo',filtro_categoria)
dt <- dt[,-1]

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

renglones <- paste(c(9:16),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_7_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) 
dt[,2] <- round(sapply(dt[,2],as.numeric),digits = 2)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas reportadas',filtro_categoria)
dt <- dt[,-1]

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

## 9. Cuentas por cobrar
```{r, echo=FALSE}
preguntas <- data.frame(preguntas = c('Días cartera promedio',
                                      'Aumento de % cartera vencida en días'))
dt <- tabla_promedio_normal(9,0) %>% bind_cols(preguntas) %>%
      dplyr::select(preguntas, everything(),-nombre_viejo) %>% 
      plyr::rename(c('preguntas'='')) 
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

## 10. Mercadotecnia
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_si_no(10,0,c(1:3),incl_na = 1)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(10,0,c(4:11),aparece_sec = 0,incl_na = 1) %>% 
      left_join(operaciones) %>% left_join(tabla_encuesta[c('questionId',
                                                            'wildcard')] %>% unique()) 
dt<- dt[,-1] %>% select(wildcard,everything(),-seccion,-questionId) %>%
      plyr::rename(c('wildcard'='¿Cuáles de los siguientes medios de promoción utilizan?'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(10,0,c(12:16),aparece_sec = 0,incl_na = 1) %>% 
      left_join(operaciones) %>% left_join(tabla_encuesta[c('questionId',
                                                            'wildcard')] %>% unique()) 
dt<- dt[!is.na(dt$wildcard),-1] %>% select(wildcard,everything(),-seccion,-questionId) %>%
      plyr::rename(c('wildcard'='¿Utilizan "social media" como medio de promoción?'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```

## 11. Tecnologías de Información
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_si_no(11,0,c(1:5),incl_na = 1)
colnames(dt)[1] <- 'Planeación'
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(6:8),incl_na = 1)
colnames(dt)[1] <- 'Seguridad'
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(9:11),incl_na = 1)
colnames(dt)[1] <- 'Internet y redes sociales'
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(12:13),incl_na = 1)
colnames(dt)[1] <- 'Sistema administrativo "back office"'
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(14:15),incl_na = 1)
colnames(dt)[1] <- 'Colaboración y administración documental'
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T) %>%
  collapse_rows(columns = 1)
```
