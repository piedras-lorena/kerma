---
title: ""
header-includes:
 - \usepackage{booktabs}
 - \usepackage{longtable}
 - \usepackage{array}
 - \usepackage{multirow}
 - \usepackage[table]{xcolor}
 - \usepackage{wrapfig}
 - \usepackage{float}
 - \usepackage{colortbl}
 - \usepackage{pdflscape}
 - \usepackage{tabu}
 - \usepackage{threeparttable}
 # hasta aquí lo nuevo
 - \usepackage{fontspec}
 - \setmainfont{Roboto}
 - \usepackage[fontsize=12pt]{scrextend}
   \usepackage[utf8]{inputenc}
   \usepackage{array}
   \usepackage{graphicx}
   \usepackage{fancyhdr}
   \pagestyle{fancy}
   \setlength\headheight{28pt}
   \fancyhead[R]{\includegraphics[width=3cm]{Logo_Encuesta_2017.png}}
   \fancyfoot[R]{\includegraphics[width=3cm]{KP_logo_standard_NEW.jpg}}
   
output: 
  pdf_document:
# header-includes:
#    - \renewcommand{\contentsname}{Índice}
    toc: TRUE
    toc_depth: 3
    latex_engine: xelatex
classoption: landscape
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, include = FALSE}
# Importamos paquetes
library(dplyr)
library(tidyr)
library(readr)
library(data.table)
library(stringr)
library(knitr)
library(DT)
library(xtable)
library(kableExtra)
library(pander)
library(scales)
library(ggplot2)
options(scipen = 999)

setwd("/home/lorena/Proyectos/Otros/kerma/r_script/reporte/")
source('../lib/utils_aux_submuestra.R')

  
id_despacho <- 38
id_submuestra <- '1'

tabla_reporte <- crear_tabla_reporte(id_despacho)
tabla_nombres_despachos <- read_csv('../../data/interim/UsuariosActivos.csv',
                                      col_types = cols(.default = 'c'))
nombre_acronimo <- tabla_nombres_despachos %>% filter(id == id_despacho)
tabla_encuesta <- read_csv('../../data/interim/tabla_encuestas_f.csv',
                           col_types = cols(.default = 'c'))
operaciones <- read_csv('../../data/interim/operaciones_preguntas - col_1.csv',
                        col_types = cols(.default = 'c')) %>%
               mutate(seccion_entera = ifelse(is.na(subseccion),paste(seccion,0,renglon,sep = '_'),paste(seccion,subseccion,renglon,sep = '_'))) %>%
               dplyr:: select(seccion_entera,pregunta_1) %>% plyr::rename(c('pregunta_1'='questionId','seccion_entera'='seccion')) %>%
               group_by(seccion) %>% slice(1)
nombres_preguntas <- tabla_encuesta %>% dplyr::select(questionId,name) %>% unique() %>% left_join(operaciones) %>%
                     filter(!is.na(seccion)) %>% dplyr::select(-questionId)

categoria <- read_csv('../../data/interim/CategoryHumanCapital.csv',
                      col_types = cols(.default = 'c')) %>% dplyr::mutate(categoria_filtro =    ifelse(is.na(description_1)|is.na(description_2),description,paste(description,description_1,sep = '_')))

diccionario_diferentes <- read_csv('../../data/interim/tablas_resumen_diferentes - Hoja 1.csv',col_types = cols(.default = 'c')) %>%
                          mutate(seccion = ifelse(is.na(renglon),paste(seccion,subseccion,sep = '_'),
                                 paste(seccion,subseccion,renglon,sep = '_')),
                                 columna_1 = word(columna_1,1,sep = '_')) %>%
                          dplyr::select(seccion,columna_1) %>%
                          plyr::rename(c('columna_1' = 'questionId'))
diccionario_aguinaldo <- data.frame(nombre_viejo = c('111','190','241','262','285'), nombre = c('Abogados','Pasantes','Gerentes área administrativa','Staff administrativo','Apoyo administrativo'),stringsAsFactors = F)

# Formato de columnas, colores y width
filtro_categoria <- sprintf('^%s_',paste(categoria$categoria_filtro %>% unique(),collapse = '_|^'))
paleta_colores <- c('#5d717f','#c6deb5')
paleta_colores_1 <- c('#bb0150','#c6deb5')
mediana <- '16em'
grande <- '30em'

# Alinear columnas
align_1 <- c("l","l",rep('c',13))
align_2 <- c("l","l",rep('c',9))
align_3 <- c("l",rep('c',3))
align_4 <- c(rep('c',2))
align_5 <- c("l","l",rep('c',14))
align_6 <- c("l",rep('c',9))

# Columnas con formato de número con coma
columnas_sueldo <- c(nombre_acronimo$acronimo,'Promedio','25%','50%','75%','Alto','Bajo','Más alto','Más bajo')
columnas <- c(nombre_acronimo$acronimo,'Promedio','25%','50%','75%','Alto','Bajo')
                        
```

\pagebreak

1. Información General
------

### Participantes de la Submuestra
1. Galicia Abogados
2. Ritch, Mueller, Heather y Nicolau
3. Nader, Hayaux & Goebel
4. Mijares, Angoitia, Cortés y Fuentes


\pagebreak

## 2. Estructura del Despacho

### 2.1. Total personal profesional
<br>
```{r, echo=FALSE, fig.width=8, fig.height=6,fig.align='center'}
dt <- tabla_promedio_normal(2,1, 1) 
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T, align = align_1) %>% 
  kable_styling(full_width = F,position = "left",font_size = 9)  %>%
  column_spec(1,width = "4em") %>%
  column_spec(3:5,background = 'gray', color = 'white',bold = T) %>%
  collapse_rows(columns = 1)

plot <- dt[,c(1,2,3,6)] 
colnames(plot) = c('n_1','n_2',nombre_acronimo$acronimo,'Promedio')
plot[, 2:3][is.na(plot[, 2:3])] <- 0
plot[is.nan(plot$Promedio),'Promedio'] <- 0
plot <- plot %>% mutate(Categoria = paste(n_1,n_2)) %>%
        dplyr::select(-n_1,-n_2) %>%
        gather(key = 'variable',value = 'total_personal',1:2)
plot['total_personal'] <- sapply(plot['total_personal'],as.numeric)

# Dividimos la gráfica en grupos
plot <- plot %>% mutate(tipo = ifelse(grepl('^Socio',Categoria),'Socio',
                                      ifelse(grepl('^Pasante',Categoria),'Pasante','Abogado')))
tipos <- plot$tipo %>% unique()

subplot <- plot %>% filter(tipo == tipos[1])
bar_plot(subplot,subplot$Categoria,subplot$total_personal,sprintf('%ss',tipos[1]),'Total Personal',subplot$variable,pallete =  paleta_colores_1,tamanio_letra = 10,nombre_cuadro = ' ') 

```

<br>
```{r, echo=FALSE, fig.width=8, fig.height=6,fig.align='center'}
subplot <- plot %>% filter(tipo == tipos[2])
bar_plot(subplot,subplot$Categoria,subplot$total_personal,sprintf('%ss',tipos[2]),'Total Personal',subplot$variable,pallete =  paleta_colores_1,tamanio_letra = 10,nombre_cuadro = ' ') 
 
subplot <- plot %>% filter(tipo == tipos[3])
bar_plot(subplot,subplot$Categoria,subplot$total_personal,sprintf('%ss',tipos[3]),'Total Personal',subplot$variable,pallete =  paleta_colores_1,tamanio_letra = 10,nombre_cuadro = ' ') 
```

\pagebreak

### 2.2. Total personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,2, 1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_1) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3:5,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.3. Total staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,3, 1)
# dt <- dt %>% mutate(nombre_viejo = gsub('_',' ',gsub('apoyo_de_administración_','',nombre_viejo))) %>%
#       plyr::rename(c('nombre_viejo' = 'Personal Profesional'))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_1) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2:4,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.4. Crecimiento personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,4, 0) 
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.5. Crecimiento personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,5, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
  kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.6. Crecimiento staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,6, 0)

dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.7. Experiencia personal profesional (años desde la titulación)
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,7, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.8. Experiencia personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,8, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.9. Experiencia staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,9, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.10. Antigüedad personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,10, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "10em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.11. Antigüedad personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,11, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.12. Antigüedad staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,12, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)

dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.13. Rotación personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,13, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.14. Rotación personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,14, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[grepl('^gerente_',dt$nombre_viejo),2:8] <- dt[grepl('^gerente_',dt$nombre_viejo),2:8]/100
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.15. Rotación staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,15, 0)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.16. Edad personal profesional
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,16, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.17. Edad personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,17, 0)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.18. Edad staff apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,18, 0)

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.19. Razones del Personal
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(2,19, 0) %>%
      plyr::rename(c('nombre_viejo' = 'Razones'))
dt[,2:8] <- format(round(sapply(dt[,2:8],as.numeric),digits = 2),scientific=FALSE)


kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>% 
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

### 2.20. Evaluación desempeño
<br>
```{r, echo=FALSE,message=FALSE}
dt<- tabla_si_no(2,20,c(1,2))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_3) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 2.20.1. Periodos de evaluación personal profesional
<br>
```{r, echo=FALSE}
dt<- distribucion_tabla(2,20.1)
panderOptions('table.split.table', 300)
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_4) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana )

bar_plot(dt,dt$Periodicidad,dt$Porcentajes,'Periodicidad','Porcentajes',pallete = c('#bb0150'),tamanio_letra = 10)

```

\pagebreak

### 2.20.2. Periodos de evaluación personal administrativo
<br>
```{r, echo=FALSE}
dt<- distribucion_tabla(2,20.2)
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_4) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "10em") %>%
  column_spec(1,width = mediana )
bar_plot(dt,dt$Periodicidad,dt$Porcentajes,'Periodicidad','Porcentajes',pallete = paleta_colores_1,tamanio_letra = 10)

```

\pagebreak

### 2.21. Tipo de evaluación
<br>
```{r, echo=FALSE, message=FALSE}
preguntas <- data.frame(preguntas = c('Las evaluaciones se comparten con el personal','Evalúan sólo los jefes','Existe evaluación de pares de subordinados a superiores','El personal administrativo evalúa al personal profesional'),
                        seccion = sprintf('2_21_%s',seq(1,4)),stringsAsFactors = F)
dt<- tabla_si_no(2,21,aparece_sec = 0)%>% left_join(preguntas) %>%
     dplyr::select(preguntas,SI,NO) %>% plyr::rename(c('preguntas'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) #%>%
  #kable_styling(latex_options = "striped")
```


### 2.22. Oficinas
<br>
```{r, echo=FALSE, message=FALSE}
preguntas <- data.frame(seccion = sprintf('2_23_%s',seq(1,7)),
                        preguntas = c('¿Cuál es el costo por m2 incluyendo mantenimiento? (Dólares)','Área en m2 rentados por despacho','Área en m2 utilizada','Área en m2 sala de juntas','Área en m2 áreas comunes','Promedio en m2 oficina de socios','Promedio en m2 oficina de abogados'),stringsAsFactors = F)
dt<- tabla_promedio_sr(2,23,seq(1,7)) %>% left_join(preguntas) %>%
     dplyr::select(preguntas,Promedio) %>% plyr::rename(c('preguntas'=''))
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
  #kable_styling(latex_options = "striped")
```

<br>

```{r, echo=FALSE, message=FALSE}
 preguntas <- data.frame(preguntas = c('Utilizan privados compartidos para los abogados'),stringsAsFactors = F)
 dt<- tabla_si_no(2,23,c(8)) %>% bind_cols(preguntas) %>%
      dplyr::select(preguntas,SI,NO) %>% plyr::rename(c('preguntas' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) #%>%
  #kable_styling(latex_options = "striped")
```

\pagebreak

## 3. Compensaciones y prestaciones
### 3.1. Sueldo base promedio mensual personal por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = align_5) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

```

\pagebreak

### 3.2. Gráficas Sueldos
<br>
```{r, echo=FALSE, message=FALSE,fig.width=8, fig.height=6,fig.align='center',warning = FALSE}
# Filtramos las preguntas de sueldo
num_preg <- operaciones %>% filter(grepl('^3_1_',seccion))
rep_graficas <- tabla_encuesta %>% filter(questionId %in% num_preg$questionId) %>%
                mutate(categoria = gsub('_','-',description_2))
rep_graficas$valueNumeric <- sapply(rep_graficas$valueNumeric, as.numeric)
 

# Creamos grupos para graficar
grupos <- c('<120','120_139','140_159','160_179','180_199','200_219','220_239')
tipos <- rep_graficas$description %>% unique()
ggplot(rep_graficas[(rep_graficas$description == tipos[1]) & (rep_graficas$description_2 %in% grupos),], aes(x = categoria,y = valueNumeric, fill = categoria)) + geom_boxplot() +
labs(title = 'Sueldo base promedio mensual por tarifa horaria',x = tipos[1],y = '\n\nSueldo base promedio mensual') +
scale_fill_brewer(palette="Greys",name = 'Tarifa') +  theme_bw(base_size = 10) + 
theme(plot.title = element_text(hjust = 0.5))

ggplot(rep_graficas[(rep_graficas$description == tipos[1]) & (rep_graficas$description_2 %!in% grupos),], aes(x = categoria,y = valueNumeric, fill = categoria)) + geom_boxplot() +
labs(title = 'Sueldo base promedio mensual por tarifa horaria',x = tipos[1],y = '\n\nSueldo base promedio mensual') +
scale_fill_brewer(palette="Greys",name = 'Tarifa') +  theme_bw(base_size = 10) + 
theme(plot.title = element_text(hjust = 0.5))

ggplot(rep_graficas[(rep_graficas$description == tipos[2]),], aes(x = description_2,y = valueNumeric, fill = description_2)) +  geom_boxplot() +
labs(title = 'Sueldo base promedio mensual por años de experiencia',x = tipos[2],y = '\n\nSueldo base promedio mensual',
fill = tipos[2]) + scale_fill_brewer(palette="Greys",name = 'Años de carrera') +  theme_bw(base_size = 10) + 
theme(plot.title = element_text(hjust = 0.5))
 

```

\pagebreak

### 3.3. Sueldo base promedio mensual personal por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,3,'personal_edad_tarifa')
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.4. Sueldo base promedio mensual personal administrativo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,4)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = align_5) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(2,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.5. Sueldo base promedio mensual staff apoyo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,5)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.6. Sueldo base promedio anual personal profesional por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,6)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = align_5) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.7. Sueldo base promedio anual personal profesional por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,7,'personal_edad_tarifa')
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.8. Sueldo base promedio anual personal administrativo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,8)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = align_5) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1:2,width = "6em") %>%
  column_spec(2,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.9. Sueldo base promedio anual staff apoyo
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,9)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.10. Sueldo base promedio anual con compensaciones personal profesional por tarifa horaria
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,10)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = align_5) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(2,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.11. Sueldo base promedio anual con compensaciones personal profesional por años de experiencia
<br>

```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,11,'personal_edad_tarifa')
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.12. Sueldo base promedio anual con compensaciones personal administrativo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,12)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = align_5) %>%
  kable_styling(full_width = F,position = "left",font_size = 8,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "6em") %>%
  column_spec(2,width = "6em") %>%
  column_spec(3,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.13. Sueldo base promedio anual con compensaciones staff apoyo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,13)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.14. Sueldo profesionales no abogados
### 3.14.1 Sueldo base promedio mensual personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Profesionales No Abogados',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

### 3.14.2 Sueldo base promedio anual personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.2)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Profesionales No Abogados',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.14.3 Sueldo base promedio anual con compensaciones personal profesional no abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_compensaciones(3,14.3)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Profesionales No Abogados',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas_sueldo)

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',14))) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.15 Incrementos de Sueldo
### 3.15.1. Incremento en 2017
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(3,15.1,porcent_h_m = 0) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>% plyr::rename(
        c('name'='2017'))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana)%>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 3.15.2. Incremento estimado para 2018
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(3,15.2,porcent_h_m = 0) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>% plyr::rename(
        c('name'='2018'))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

kable(dt, format = "latex", booktabs = T,longtable = T,align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana)%>%
  column_spec(2,bold = T,background = 'gray', color = 'white') %>%
  collapse_rows(columns = 1)

```

\pagebreak

### 3.15.3 Fecha de incremento
<br>
```{r, echo=FALSE, message=FALSE, fig.width=6, fig.height=3}

dt <- tabla_reporte %>% filter(grepl('^3_15.3',seccion)) %>% dplyr::select(respuesta_unica,valor_1) %>%
      plyr::rename(c('respuesta_unica' = 'Mes','valor_1' = 'Porcentaje')) %>%
      mutate(Mes = gsub("^(\\w)(\\w+)", "\\U\\1\\L\\2",Mes,perl = T))
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana )#%>%
  #kable_styling(latex_options = "striped")
bar_plot(dt,dt$Mes,dt$Porcentaje,titulo_x = 'Fecha incremento',titulo_y = 'Porcentaje de despachos',tamanio_letra = 9)

```

\pagebreak

### 3.16. Operación
### 3.16.1 Forma de pago de abogados
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(3,16.1,renglones = c(1:5),nombre_col = 'Forma de pago mensual abogados')
kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
 # kable_styling(latex_options = "striped")

dt <- tabla_si_no(3,16.1,renglones = c(6),aparece_sec = 0) %>%
      mutate(Pregunta = '¿En la remuneración se reconoce la originación de clientes/asuntos?') %>% dplyr::select(Pregunta,SI,NO) %>%
      plyr::rename(c('Pregunta'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
 # kable_styling(latex_options = "striped")

dt <- distribucion_tabla(3,16.1,renglones = c(7:12),nombre_col = '¿Cómo se reconoce la originación de clientes/asuntos?')
kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande )# %>%
  #kable_styling(latex_options = "striped")

```

\pagebreak

### 3.16.2. Fórmula de remuneración de socios
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(3,16.2,nombre_col = '¿Cuál es su sistema de remuneración de socios?')
kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande )# %>%
 # kable_styling(latex_options = "striped")
```

\pagebreak

### 3.16.3. Plan de carrera y desarrollo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.3,c(1),aparece_sec = 0) %>%
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) 
dt <- dt[,-1] %>%
      dplyr::select(name,everything(),-seccion,-questionId) %>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',3))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')
  #kable_styling(latex_options = "striped")

dt <- tabla_promedio_normal(3,'16.3') %>% filter(nombre_viejo == '237') %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(), by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo)%>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')

dt <- tabla_si_no(3,16.3,c(3),aparece_sec = 0) %>%
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) 
dt <- dt[,-1] %>%
      dplyr::select(name,everything(),-seccion,-questionId) %>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',3))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')

dt <- tabla_promedio_normal(3,'16.3') %>% filter(nombre_viejo == '240') %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(), by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo)%>%
      plyr::rename(c('name' = ''))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')

```

```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(3,'16.3',c(5:13),'¿Cuántos años en promedio le debe tomar a un abogado recién recibido ser socio de la firma? ')
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('c','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
 # kable_styling(latex_options = "striped")
```

\pagebreak

### 3.16.4. Comportamiento estructura despacho personal profesional
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.4,c(1),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Contrataciones') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")# %>%
  #kable_styling(latex_options = "striped")


dt <- tabla_reporte %>% filter(grepl('^3_16.4_2',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% contratación') %>% plyr::rename(c('nombre_viejo'=''))

dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')

dt <- tabla_si_no(3,16.4,c(3),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Aumento de sueldos') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
#  kable_styling(latex_options = "striped")

dt <- tabla_reporte %>% filter(grepl('^3_16.4_4',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Aumento de sueldos') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')

dt <- tabla_si_no(3,16.4,c(5),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Ascensos de nivel') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
  #kable_styling(latex_options = "striped")

dt <- tabla_si_no(3,16.4,c(6),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Recorte de personal') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
  #kable_styling(latex_options = "striped")

dt <- tabla_reporte %>% filter(grepl('^3_16.4_7',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Recorte de personal') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')

dt <- tabla_si_no(3,16.4,c(8),aparece_sec = 0) %>%
      mutate(`Personal profesional` = 'Incrementos 1er semestre 2018') %>% select(`Personal profesional`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")# %>%
 # kable_styling(latex_options = "striped")
```

\pagebreak

### 3.16.5. Comportamiento estructura despacho personal administrativo
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(3,16.5,c(1),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Contrataciones') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
  #kable_styling(latex_options = "striped")


dt <- tabla_reporte %>% filter(grepl('^3_16.5_2',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% contratación') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')


dt <- tabla_si_no(3,16.5,c(3),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Aumento de sueldos') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
  #kable_styling(latex_options = "striped")

dt <- tabla_reporte %>% filter(grepl('^3_16.5_4',seccion)) %>% dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% mutate(nombre_viejo = '% Aumento de sueldos') %>% plyr::rename(c('nombre_viejo'=''))
dt[,2:8] <- sapply(dt[,2:8],as.numeric) /100
dt[,2:8] <- apply(dt[,2:8],2,function(x) mapply(cambiar_porcent,x))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(2,bold = T, background = 'gray',color = 'white')

dt <- tabla_si_no(3,16.5,c(5),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Ascensos de nivel') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
  #kable_styling(latex_options = "striped")

dt <- tabla_si_no(3,16.5,c(6),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Recorte de personal') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")# %>%
  #kable_styling(latex_options = "striped")


dt <- tabla_si_no(3,16.5,c(7),aparece_sec = 0) %>%
      mutate(`Personal administrativo` = 'Incrementos 1er semestre 2018') %>% select(`Personal administrativo`, SI, NO)
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
 # kable_styling(latex_options = "striped")

```

\pagebreak

## 4. Bonos e incentivos

### 4.1.1. Personal profesional
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_promedio_normal(4,0)
dt <- formato_primera_col(dt = dt,nombre_1 = 'col_1',nombre_2 = 'Bono (expresado en meses que se otorgan)',filtro_categoria)
dt_aux <- dt %>% filter(col_1 %in% c('Abogado tarifa ','Pasante ')) %>% plyr::rename(c('col_1' = ' '))
kable(dt_aux, format = "latex", booktabs = T,longtable = T,align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

```

\pagebreak

### 4.1.2. Personal administrativo

```{r, echo=FALSE, message=FALSE}
dt_aux <- dt %>% filter(col_1 %in% c('Gerente de administración ','Staff de administración ')) %>% plyr::rename(c('col_1' = ' '))
kable(dt_aux, format = "latex", booktabs = T,longtable = T,align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 4.1.3. Apoyo de administración

```{r, echo=FALSE, message=FALSE}
dt_aux <- dt %>% filter(col_1 %in% c('Apoyo de administración ')) %>% plyr::rename(c('col_1' = ' '))
kable(dt_aux, format = "latex", booktabs = T,longtable = T,align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```


\pagebreak

### 4.1 Periodicidad y fecha de entrega del bono
<br>
```{r, echo=FALSE, message=FALSE}
dt <- distribucion_tabla(4,1,renglones = c(1:12),nombre_col = 'Fecha en que se entrega el bono de Abogados') 
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
  #kable_styling(latex_options = "striped")

dt <- distribucion_tabla(4,1,renglones = c(13:24),nombre_col = 'Fecha en que se entrega el bono de Administrativos') 
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
  #kable_styling(latex_options = "striped")

dt <- distribucion_tabla(4,1,renglones = c(25:28),nombre_col = 'Periodicidad del bono Personal Profesional') 
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
  #kable_styling(latex_options = "striped")

dt <- distribucion_tabla(4,1,renglones = c(29:32),nombre_col = 'Periodicidad del bono Personal Administrativo') 
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) #%>%
  #kable_styling(latex_options = "striped")

```

\pagebreak

### 4.2 Elementos para determinar el bono
<br>
```{r, echo=FALSE, message=FALSE, fig.width=6, fig.height=3}
dt <- tabla_si_no(4,2,c(1:6),0) %>% left_join(diccionario_diferentes) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique())
dt <- dt[,-1] %>% dplyr::select(name,SI,NO) %>%
      plyr::rename(c('name' = 'Elementos para determinar el bono de Personal Profesional'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) # %>%
  #kable_styling(latex_options = "striped")

bar_plot(dt,dt$`Elementos para determinar el bono de Personal Profesional`,dt$SI,titulo_x = 'Elementos bono Personal Profesional',
        titulo_y = 'Porcentaje de despachos',tamanio_letra = 9)

dt <- tabla_si_no(4,2,c(7:10),0) %>% left_join(diccionario_diferentes) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique())
```

\pagebreak

```{r, echo=FALSE, message=FALSE, fig.width=6, fig.height=3}
dt <- dt[,-1] %>% dplyr::select(name,SI,NO) %>%
      plyr::rename(c('name' = 'Elementos para determinar el bono de Personal Administrativo'))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) # %>%
  #kable_styling(latex_options = "striped")

bar_plot(dt,dt$`Elementos para determinar el bono de Personal Administrativo`,dt$SI,titulo_x = 'Elementos bono Personal Profesional',
        titulo_y = 'Porcentaje de despachos',tamanio_letra = 9)
```

\pagebreak

### 4.3. Porcentaje de sueldo que representa la parte variable

```{r, echo=FALSE}
dt <- tabla_promedio_normal(4,3) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(), by = c('nombre_viejo' = 'questionId')) %>%
      dplyr::select(name, everything(),-nombre_viejo) %>% plyr::rename(c('name' = ' '))
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')  
```


\pagebreak

## 5. Prestaciones
### 5.1. Aguinaldo personal profesional
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_promedio_normal(5,1.1) %>% left_join(diccionario_aguinaldo) %>%
      dplyr::select(nombre,everything(),-nombre_viejo) %>% plyr::rename(c('nombre'=''))
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana) %>%
  column_spec(2, bold = T,background = 'gray', color = 'white')
```

### 5.2. Aguinaldo personal administrativo
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_promedio_normal(5,2) %>% left_join(diccionario_aguinaldo) %>%
      dplyr::select(nombre,everything(),-nombre_viejo) %>% plyr::rename(c('nombre'=''))
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana )  %>%
  column_spec(2, bold = T,background = 'gray', color = 'white')
```

### 5.3. Aguinaldo staff apoyo
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_promedio_normal(5,3) %>% left_join(diccionario_aguinaldo) %>%
      dplyr::select(nombre,everything(),-nombre_viejo) %>% plyr::rename(c('nombre'=''))
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2, bold = T,background = 'gray', color = 'white')
```

\pagebreak

### 5.4. Reparto de utilidades
<br>
```{r, echo=FALSE, message=FALSE}
dt <- tabla_si_no(5,5,c(1),aparece_sec = 0) %>%
      mutate(Pregunta = '¿Este año se realizará reparto de utilidades?') %>% select(Pregunta, SI, NO) %>% plyr::rename(
        c('Pregunta'=''))
kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  collapse_rows(columns = 1)

dt <- distribucion_tabla(5,5,c(2:5),nombre_col = '¿Correspondientes a qué año?') 
panderOptions('table.split.table', 300)      
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_4) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) 

preguntas <- data.frame(preguntas = c('No de días considerados al año','Sueldo máximo considerado'), seccion = c('5_5_6','5_5_7'),stringsAsFactors = F)
dt <-tabla_reporte %>% filter(grepl('^5_5_(6$|7$)',seccion)) %>%   dplyr::select(seccion,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) %>% left_join(preguntas) %>% select(preguntas,everything(),-seccion) %>%
plyr::rename(c('preguntas' = ' '))
  
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') 

dt <- distribucion_tabla(5,5,c(8:11),nombre_col = 'Mes de pago para reparto de utilidades')
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_4) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande)  
```

\pagebreak

### 5.5. Vacaciones personal profesional
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_promedio_normal(5,6)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 5.6. Vacaciones personal administrativo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,7)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Administrativo',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 5.7. Vacaciones staff de apoyo
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(5,8)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Staff Apoyo',filtro_categoria)
dt <- dt[,-1]
kable(dt, format = "latex", booktabs = T,longtable = T,align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

## 6. Seguros y jubilación
### 6.1. Seguro de vida
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_reporte %>% filter(grepl('^6_1_',seccion)) %>% dplyr::select(valor_1_1,valor_2_1,Promedio,
                                                                         valor_1_3,valor_2_3,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c(' ','SI','Años de trabajo asegurados','SI')


kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',3))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  add_header_above(c(" ", "Seguro de Vida" = 2, "Seguro de Vida en el Extranjero" = 1)) %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 6.2. Gastos médicos
<br>

```{r, echo=FALSE,message=FALSE}
dt <- tabla_reporte %>% filter(grepl('^6_2_',seccion)) %>% dplyr::select(valor_1_1,valor_2_1,Promedio,
                                                                         valor_1_3,valor_2_3,seccion, valor_1_4,valor_2_4) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
# Nos deshacemos de los no
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c(' ','SI','Suma Asegurada','SI','SI')
dt <- poner_comas(dt,c('Suma Asegurada'))

kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  add_header_above(c(" ", "Gastos Médicos Mayores" = 2, "Gastos Médicos en el Extranjero" = 1,
                     "Gastos Médicos Menores" = 1)) %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 6.3. Edad de retiro y jubilación
<br>

```{r, echo=FALSE,message=FALSE}
dt <- tabla_reporte %>% filter(grepl('^6_3_',seccion)) %>% dplyr::select(valor_1_1,valor_2_1,
                                                                         valor_1_3,valor_2_3,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
# Nos deshacemos de los no
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c(' ','SI','SI')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "15em") %>%
  add_header_above(c(" ", "Edad para el retiro" = 1, "Planes de jubilación" = 1)) %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 6.4. Sucesión y Seguro de Responsabilidad Civil
<br>

```{r, echo=FALSE,message=FALSE}
renglones <- paste(c(1:7),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^6_4_(%s)$',renglones),seccion)) %>% dplyr::select(valor_1,valor_2,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
# Nos deshacemos de los no
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c('Sistema de sucesión','SI')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

renglones <- paste(c(8:12),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^6_4_(%s)$',renglones),seccion)) %>% dplyr::select(valor_1,valor_2,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
# Nos deshacemos de los no
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c('Seguro de Responsabilidad Civil Profesional','SI')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em")

```

\pagebreak

### 6.5. Días festivos
<br>

```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_5_',seccion) & !is.na(respuesta_unica)) %>% dplyr::select(respuesta_unica,Porcentaje)
dt[,2] <- sapply(dt[,2],as.numeric)
dt[,2] <- apply(dt[,2],2, function(x) mapply(cambiar_porcent,x))

colnames(dt) <- c('Días festivos adicionales a la ley', 'No laborable')
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") 
```

\pagebreak

### 6.6. Otras prestaciones
<br>
```{r, echo=FALSE,message=FALSE}

renglones <- paste(c(1:19),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^6_6_(%s)$',renglones),seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,valor_1_3,valor_2_3,valor_1_4,valor_2_4,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c(' ', 'SI','SI','SI','SI')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  add_header_above(c(" ", "Previsión Social" = 1, "Fondo de Ahorro" = 1, "Vales de Despensa" = 1, "Ayuda para Comida" = 1)) %>%
  collapse_rows(columns = 1)

```


```{r, echo=FALSE,message=FALSE}
renglones <- paste(c(20:21),collapse = '|')
dt <- distribucion_tabla(6,6,renglones,nombre_col = 'Tipo de ayuda para comida')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") #%>%
  #kable_styling(latex_options = "striped")
```  

\pagebreak

### 6.7. Apoyo en estudios
<br>
```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_7_',seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,valor_1_3,valor_2_3,valor_1_4,valor_2_4,valor_1_5,valor_2_5,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c(' ', 'SI','SI','SI','SI','SI')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',5))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  add_header_above(c(" ", "Internship" = 1, "Apoyo en estudios y capacitación" = 1, "Coaching" = 1, "Becas nacionales" = 1,
                     "Becas extranjero"= 1)) %>%
  collapse_rows(columns = 1)

```

\pagebreak

### 6.8. Apoyo en pago de asociaciones y promoción
<br>
```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_8_',seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,valor_1_3,valor_2_3,valor_1_4,valor_2_4,valor_1_5,valor_2_5,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c(' ', 'SI','SI','SI','SI','SI')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',5))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "12em") %>%
  add_header_above(c(" ", "Celular" = 1, "Pago de cuotas en asociaciones nacionales" = 1, "Pago de cuotas en asociaciones internacionales" = 1,"Viajes de promoción" = 1,"Colegiaturas"= 1)) %>%
  collapse_rows(columns = 1)

```

\pagebreak

### 6.9. Automóvil/motocicleta
<br>
```{r, echo=FALSE,message=FALSE}

dt <- tabla_reporte %>% filter(grepl('^6_9_',seccion)) %>% 
      dplyr::select(valor_1,valor_2,valor_1_2,valor_2_2,seccion) %>% 
      left_join(diccionario_diferentes) %>% left_join(tabla_encuesta[c('questionId','name')] %>% unique()) %>%
      dplyr::select(name,everything(),-questionId,-seccion)
dt <- dt %>% dplyr::select(-starts_with('valor_2'))
colnames(dt) <- c(' ', 'SI','SI')

kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l','c','c')) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  add_header_above(c(" ", "Automóvil" = 1, "Motocicleta" = 1)) %>%
  collapse_rows(columns = 1)

```

\pagebreak

## 7. Ingresos y rentabilidad

### 7.1. Ingresos
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,1) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>%
      plyr::rename(c('name'='Ingresos'))
dt <- poner_comas(dt,columnas)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

### 7.2. Tipo de cambio
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,2) %>%
      left_join(tabla_encuesta[c('questionId','name')] %>% unique(),
                by = c('nombre_viejo'='questionId')) %>%
      dplyr::select(name,everything(),-nombre_viejo) %>%
      plyr::rename(c('name'='Ingresos'))
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = '24em' ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white')
```

\pagebreak

### 7.3. Razones ingresos
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(7,3)
dt[,2] <- round(sapply(dt[,2],as.numeric),digits = 2)
dt <- poner_comas(dt,columnas)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

### 7.4. Facturación
<br>
```{r, echo=FALSE,message=FALSE}
preguntas <- data.frame(Preguntas = c('¿En qué porcentaje de las facturas se otorgan descuento?',
                                      '¿Qué porcentaje de la facturación se cobra en pesos?',
                                      '¿Qué porcentaje de las horas facturadas no las paga el cliente?',
                                      '¿Cuál es el descuento promedio que han otorgado esta año a sus clientes?'),
                        seccion = sprintf('7_4_%s',c(1:4)), stringsAsFactors = F)
dt <- tabla_reporte %>% filter(grepl('^7_4_',seccion)) %>%
      dplyr::select(seccion,Promedio,`25%`,`50%`,`75%`,Alto,Bajo) %>% left_join(preguntas) %>%
      dplyr::select(Preguntas,everything(),-seccion) %>% plyr::rename(c('Preguntas'=''))
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',5)))  %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande )
```

\pagebreak

## 8. Tarifas y productividad
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,0)
dt <- formato_primera_col(dt = dt,nombre_1 = 'Tarifa promedio por hora (USD)',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "20em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 8.1. Horas objetivo anuales por tarifa horaria
<br>
```{r, echo=FALSE,message=FALSE,fig.width=8, fig.height=6,fig.align='center',warning=FALSE}
dt <- tabla_promedio_normal(8,1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- poner_comas(dt,columnas)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_promedio_normal(8,1)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
plot <- dt[,1:4]
colnames(plot)[1] <- 'Categoria'
plot <- plot %>% mutate(tipo = ifelse(grepl('^Socio',Categoria),'Socio',
                      ifelse(grepl('^Pasante',Categoria),'Pasante','Abogado')),
                      cat_completa = paste(Categoria,`Personal Profesional`)) %>%
                gather(key = 'variable',value = 'horas_objetivo',3:4)
tipos <- plot$tipo %>% unique()

```

#### 8.1.1. Horas objetivo para Socios

```{r, echo=FALSE,message=FALSE,fig.width=8, fig.height=6,fig.align='center',warning=FALSE}
subplot <- plot %>% filter(tipo == tipos[1])
bar_plot(subplot,subplot$cat_completa,subplot$horas_objetivo,sprintf('%ss',tipos[1]),'Horas objetivo',subplot$variable,pallete =  paleta_colores_1,tamanio_letra = 10,nombre_cuadro = '') 
```

#### 8.1.2. Horas objetivo para Abogados

```{r, echo=FALSE,message=FALSE,fig.width=8, fig.height=6,fig.align='center',warning=FALSE}
subplot <- plot %>% filter(tipo == tipos[2])
bar_plot(subplot,subplot$cat_completa,subplot$horas_objetivo,sprintf('%ss',tipos[2]),'Horas objetivo',subplot$variable,pallete =  paleta_colores_1,tamanio_letra = 10,nombre_cuadro = '') 
```

#### 8.1.2. Horas objetivo para Pasantes

```{r, echo=FALSE,message=FALSE,fig.width=8, fig.height=6,fig.align='center',warning=FALSE}
subplot <- plot %>% filter(tipo == tipos[3])
bar_plot(subplot,subplot$cat_completa,subplot$horas_objetivo,sprintf('%ss',tipos[3]),'Horas objetivo',subplot$variable,pallete =  paleta_colores_1,tamanio_letra = 10,nombre_cuadro = '') 
```


\pagebreak

### 8.2. Horas reportadas anuales por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,2)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
dt <- poner_comas(dt,columnas)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 8.3. Horas facturadas anuales por tarifa horaria
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,3)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 8.4. Realización
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,4)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 8.5. Productividad
<br>
```{r, echo=FALSE}
dt <- tabla_promedio_normal(8,5)
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))

dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Personal Profesional',filtro_categoria)
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_2) %>%
  kable_styling(full_width = F,position = "left",font_size = 9,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = "8em") %>%
  column_spec(3,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 8.6. Horas objetivo, horas reportadas, horas facturadas personal profesional por años de experiencia
<br>
```{r, echo=FALSE}
renglones <- paste(c(1:8),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_6_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo)))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas objetivo',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

renglones <- paste(c(9:16),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_6_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) 
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas reportadas',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas)

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

```{r, echo=FALSE}
renglones <- paste(c(17:24),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_6_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo)))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas facturadas',filtro_categoria)
dt <- dt[,-1]
dt <- poner_comas(dt,columnas)

kable(dt, format = "latex", booktabs = T,longtable = T) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

### 8.7. Realización y productividad abogados por años de experiencia
<br>
```{r, echo=FALSE}
renglones <- paste(c(1:8),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_7_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo)))
dt[,2:8] <- sapply(dt[,2:8],as.numeric)
dt[,2:8] <- apply(dt[,2:8],2, function(x) mapply(cambiar_porcent,x))
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas objetivo',filtro_categoria)
dt <- dt[,-1]

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

renglones <- paste(c(9:16),collapse = '|')
dt <- tabla_reporte %>% filter(grepl(sprintf('^8_7_(%s)$',renglones),seccion)) %>%
      dplyr::select(nombre_viejo,valor,Promedio,`25%`,`50%`,`75%`,Alto,Bajo,cuantil,`VS PROM`)  %>% 
      plyr::rename(c('valor'= toupper(nombre_acronimo$acronimo))) 
dt[,2] <- round(sapply(dt[,2],as.numeric),digits = 2)
dt <- formato_primera_col(dt = dt,nombre_1 = '',nombre_2 = 'Horas reportadas',filtro_categoria)
dt <- dt[,-1]

kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

## 9. Cuentas por cobrar
```{r, echo=FALSE}
preguntas <- data.frame(preguntas = c('Días cartera promedio',
                                      'Aumento de % cartera vencida en días'))
dt <- tabla_promedio_normal(9,0) %>% bind_cols(preguntas) %>%
      dplyr::select(preguntas, everything(),-nombre_viejo) %>% 
      plyr::rename(c('preguntas'='')) 
kable(dt, format = "latex", booktabs = T,longtable = T, align = align_6) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = mediana ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

## 10. Mercadotecnia
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_si_no(10,0,c(1:3),incl_na = 1)
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande ) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(10,0,c(4:11),aparece_sec = 0,incl_na = 1) %>% 
      left_join(operaciones) %>% left_join(tabla_encuesta[c('questionId',
                                                            'wildcard')] %>% unique()) 
dt<- dt[,-1] %>% select(wildcard,everything(),-seccion,-questionId) %>%
      plyr::rename(c('wildcard'='¿Cuáles de los siguientes medios de promoción utilizan?'))
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(10,0,c(12:16),aparece_sec = 0,incl_na = 1) %>% 
      left_join(operaciones) %>% left_join(tabla_encuesta[c('questionId',
                                                            'wildcard')] %>% unique()) 
dt<- dt[!is.na(dt$wildcard),-1] %>% select(wildcard,everything(),-seccion,-questionId) %>%
      plyr::rename(c('wildcard'='¿Utilizan "social media" como medio de promoción?'))
kable(dt, format = "latex", booktabs = T,longtable = T,align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)
```

\pagebreak

## 11. Tecnologías de Información
<br>
```{r, echo=FALSE,message=FALSE}
dt <- tabla_si_no(11,0,c(1:5),incl_na = 1)
colnames(dt)[1] <- 'Planeación'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') 


dt <- tabla_si_no(11,0,c(6:8),incl_na = 1)
colnames(dt)[1] <- 'Seguridad'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(9:11),incl_na = 1)
colnames(dt)[1] <- 'Internet y redes sociales'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(12:13),incl_na = 1)
colnames(dt)[1] <- 'Sistema administrativo "back office"'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(14:15),incl_na = 1)
colnames(dt)[1] <- 'Colaboración y administración documental'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(16:18),incl_na = 1)
colnames(dt)[1] <- 'Correo electrónico'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(19:20),incl_na = 1)
colnames(dt)[1] <- 'Reuniones virtuales y proyectos'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

dt <- tabla_si_no(11,0,c(21:22),incl_na = 1)
colnames(dt)[1] <- 'Aplicaciones móviles'
kable(dt, format = "latex", booktabs = T,longtable = T, align = c('l',rep('c',4))) %>%
  kable_styling(full_width = F,position = "left",font_size = 10,latex_options = c("repeat_header"))  %>%
  column_spec(1,width = grande) %>%
  column_spec(2,bold = T,background = 'gray',color = 'white') %>%
  collapse_rows(columns = 1)

```
